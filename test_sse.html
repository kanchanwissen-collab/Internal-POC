<!DOCTYPE html>
<html>
<head>
    <title>SSE Test for Live Logs</title>
</head>
<body>
    <h1>SSE Live Logs Test</h1>
    <p>Testing SSE endpoint for session: <strong>67887c8a-7d12-47ff-b12c-9f13e9a11de8</strong></p>
    
    <div id="status">Connecting...</div>
    <div id="logs" style="font-family: monospace; background: #f0f0f0; padding: 10px; height: 400px; overflow-y: auto; white-space: pre-wrap;"></div>
    
    <script>
        const sessionId = '67887c8a-7d12-47ff-b12c-9f13e9a11de8';
        const sseUrl = `http://localhost:8000/api/v1/stream-logs/request/${sessionId}`;
        
        console.log('Connecting to SSE:', sseUrl);
        
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');
        
        const eventSource = new EventSource(sseUrl);
        
        eventSource.onopen = function(event) {
            statusDiv.textContent = 'Connected ✅';
            statusDiv.style.color = 'green';
            console.log('SSE connection opened');
        };
        
        eventSource.onmessage = function(event) {
            console.log('Received SSE message:', event.data);
            logsDiv.textContent += new Date().toISOString() + ' - ' + event.data + '\n';
            logsDiv.scrollTop = logsDiv.scrollHeight;
        };
        
        eventSource.onerror = function(event) {
            statusDiv.textContent = 'Connection error - retrying... ❌';
            statusDiv.style.color = 'red';
            console.error('SSE error:', event);
        };
        
        // Test publishing a message after 3 seconds
        setTimeout(() => {
            fetch(`http://localhost:8000/api/v1/stream-logs/request/${sessionId}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({message: 'Test from browser'})
            }).catch(console.error);
        }, 3000);
    </script>
</body>
</html>
